---
layout: default
permalink: /
---

<main>
	<br><br>
	<div id="info" style="text-align: center;">
		<h1>Bugiver</h1>
		<p>
			Bugiver is a simple website that iterates through everyone that you are following and selects a random issue in a completely random
			repository in a language of your choice. I have designed it as my personal "I have nothing to do" button that gives me something
			to do in an attempt to encourage myself to contribute to more repositories than I create. Its source code, which you can find on
			<a href="/redirects/?t=github&d=bugiver">GitHub</a>, is published under the Apache 2.0 License.
		</p>
		<p>To start bug hunting, sign into your GitHub account below to give this website access to your account.</p>
		<button onclick="location.href='https://github.com/login/oauth/authorize?client_id={{ site.client_id }}';">Sign In</button>
	</div>
	<div id="option" style="display: none;">
		<h1>Options</h1>
		<collapse>
			<h4>Languages: <span id="selectedLanguages">All</span></h4>
			<div id="languages" class="grid"></div>
		</collapse>
		<collapse>
			<h4>Tags: <span id="selectedTags">All</span></h4>
			<div id="tags" class="grid"></div>
		</collapse>
		<br>
		<button onclick="randomIssue();">Done</button>
	</div>
	<div id="issue" style="display: none;">
		
		<button onclick="randomIssue();">Next Bug</button>
	</div>
	<br><br>
</main>

<script type="text/javascript" src="https://jfenn.me/js/utils.js"></script>
<script type="text/javascript">
	const _github = {
		following: {},
		repos: {},
		languages: {},
		labels: {},
		issues: {}
	};

	const _infoElement = document.getElementById("info");
	
	const _optionElement = document.getElementById("option");
	const _languagesElement = document.getElementById("languages");
	const _selectedLanguagesElement = document.getElementById("selectedLanguages");
	
	const _issueElement = document.getElementById("issue");

	let args = UrlUtil.getCurrentArguments();
	const _token = args.token || !localStorage ? args.token : localStorage.getItem("{{ site.storage_id }}/access_token");

	var _selectedLangs = localStorage ? JSON.parse(localStorage.getItem("{{ site.storage_id }}/pref_langs")) : {};
	_selectedLangs = _selectedLangs ? _selectedLangs : {};

	if (_token) dispConfigureIssue();

	function dispConfigureIssue() {
		_infoElement.style.display = "none";
		_issueElement.style.display = "none";
		
		if (args.repo && args.issue)
			dispLoadIssue(args.repo, args.issue);
		else {
			_optionElement.style.display = null;

			if (Object.keys(_github.languages).length > 0) {
				_selectedLanguagesElement.innerText = "All";
				ElementUtil.clearElement(_languagesElement);
				
				for (let lang in _github.languages) {
					_languagesElement.append(ElementUtil.createElement("<checkbox class=\"item\"><input id=\"language" + lang + "\" name=\"" + lang
							+ "\" type=\"checkbox\"><label id=\"languageLabel" + lang + "\" for=\"language" + lang + "\"></label><span>" + lang + "</span></checkbox>"));
					
					let checkbox = document.getElementById("language" + lang);
					checkbox.checked = _selectedLangs[lang];
					checkbox.addEventListener("click", function() {
						if (this.checked)
							_selectedLangs[this.getAttribute("name")] = true;
						else delete _selectedLangs[this.getAttribute("name")];

						let text = "";
						for (let lang in _selectedLangs) {
							text += ", " + lang;
						}

						if (text.length > 0)
							_selectedLanguagesElement.innerText = text.substring(2);		
						else _selectedLanguagesElement.innerText = "All";

						if (localStorage)
							localStorage.setItem("{{ site.storage_id }}/pref_langs", JSON.stringify(_selectedLangs));
					});

					onElement(document.getElementById("languageLabel" + lang));
				}

				let text = "";
				for (let lang in _selectedLangs) {
					text += ", " + lang;
				}

				if (text.length > 0)
					_selectedLanguagesElement.innerText = text.substring(2);		
				else _selectedLanguagesElement.innerText = "All";
			} else {
				fetchFollowing("TheAndroidMaster", function() { dispConfigureIssue(); });
			}
		}
	}

	function dispRandomIssue() {
		_infoElement.style.display = "none";
		_optionElement.style.display = "none";
		_issueElement.style.display = "none";
	}

	function dispIssue(repo, issue) {
		_infoElement.style.display = "none";
		_optionElement.style.display = "none";
		_issueElement.style.display = "none";
	}

	function fetchFollowing(user, func) {
		for (let what in _github.following) {
			if (func)
				func(_github.following);
			
			return;
		}
	
		const req = new XMLHttpRequest();
		req.onreadystatechange = function() {
			if (req.readyState === 4 && (req.status === 200 || req.status == 0)) {
				let obj = JSON.parse(req.responseText);
				for (let i = 0; i < obj.length; i++) {
					_github.following[obj[i].login] = obj[i];
					fetchRepositories(obj[i].login, i == obj.length - 1 ? func : null);
				}
			}
		};
		req.open("GET", "https://api.github.com/users/" + user + "/following", true);
		if (_token)
			req.setRequestHeader("Authorization", "token " + _token);
		
		req.send();
	}

	function fetchRepositories(user, func) {	
		const req = new XMLHttpRequest();
		req.onreadystatechange = function() {
			if (req.readyState === 4 && (req.status === 200 || req.status == 0)) {
				let obj = JSON.parse(req.responseText);
				for (let i = 0; i < obj.length; i++) {
					if (!obj[i].fork && obj[i].has_issues) {
						_github.repos[obj[i].name] = obj[i];
						fetchLanguages(obj[i].full_name);
					}
				}

				let keys = Object.keys(_github.repos);
				for (let i = 0; i < keys.length; i++) {
					fetchIssues(_github.repos[keys[i]].full_name, i == keys.length - 1 ? func : null);
				}

				if (func)
					func(_github.repos);
			}
		};
		req.open("GET", "https://api.github.com/users/" + user + "/repos", true);
		if (_token)
			req.setRequestHeader("Authorization", "token " + _token);
		
		req.send();		
	}

	function fetchLanguages(repo, func) {
		const req = new XMLHttpRequest();
		req.onreadystatechange = function() {
			if (req.readyState === 4 && (req.status === 200 || req.status == 0)) {
				let obj = JSON.parse(req.responseText);
				for (let lang in obj) {
					_github.languages[lang] = true;
				}

				if (func)
					func(_github.languages);
			}
		};
		req.open("GET", "https://api.github.com/repos/" + repo + "/languages", true);
		if (_token)
			req.setRequestHeader("Authorization", "token " + _token);
		
		req.send();
	}

	function fetchIssues(repo, func) {
		const req = new XMLHttpRequest();
		req.onreadystatechange = function() {
			if (req.readyState === 4 && (req.status === 200 || req.status == 0)) {
				let obj = JSON.parse(req.responseText);
				for (let i = 0; i < obj.length; i++) {
					if (!obj[i].pull_request) {
					_github.issues[repo + "/issues/" + obj[i].number] = obj[i];
						for (let i2 = 0; obj[i].labels && i2 < obj[i].labels.length; i2++) {
							_github.labels[obj[i].labels[i2].name] = true;
						}
					}
				}

				if (func)
					func(_github.labels);
			}
		};
		req.open("GET", "https://api.github.com/repos/" + repo + "/issues", true);
		if (_token)
			req.setRequestHeader("Authorization", "token " + _token);
		
		req.send();
	}
</script>
