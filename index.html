---
layout: default
permalink: /
---

<main>
	<br><br>
	<div id="info" style="text-align: center;">
		<h1>Bugiver</h1>
		<p>
			Bugiver is a simple website that iterates through everyone that you are following and selects a random issue in a completely random
			repository in a language of your choice. I have designed it as my personal "I have nothing to do" button that gives me something
			to do in an attempt to encourage myself to contribute to more repositories than I create. Its source code, which you can find on
			<a href="/redirects/?t=github&d=bugiver">GitHub</a>, is published under the Apache 2.0 License.
		</p>
		<p>To start bug hunting, sign into your GitHub account below to give this website access to your account.</p>
		<button onclick="location.href='https://github.com/login/oauth/authorize?client_id={{ site.client_id }}';">Sign In</button>
	</div>
	<div id="option" style="display: none;">
		<h1>Options</h1>
		<collapse>
			<h4>Languages: <span id="selectedLanguages">All</span></h4>
			<div id="languages"></div>
		</collapse>
		<button onclick="randomIssue();">Done</button>
	</div>
	<div id="issue" style="display: none;">
		
		<button onclick="randomIssue();">Next Bug</button>
	</div>
	<br><br>
</main>

<script type="text/javascript" src="https://jfenn.me/js/utils.js"></script>
<script type="text/javascript">
	const _gitHubLanguagesURL = "https://raw.githubusercontent.com/github/linguist/master/lib/linguist/languages.yml";

	const _infoElement = document.getElementById("info");
	
	const _optionElement = document.getElementById("option");
	const _languagesElement = document.getElementById("languages");
	const _selectedLanguagesElement = document.getElementById("selectedLanguages");
	
	const _issueElement = document.getElementById("issue");

	let args = UrlUtil.getCurrentArguments();
	const _token = args.token ? args.token : localStorage.getItem("{{ site.storage_id }}/access_token");

	var _langs = [];
	var _selectedLangs = {};

	if (_token) configureIssue();

	function configureIssue() {
		_infoElement.style.display = "none";
		_issueElement.style.display = "none";
		
		if (args.repo && args.issue)
			loadIssue(args.repo, args.issue);
		else {
			_optionElement.style.display = null;

			if (_langs.length > 0) {
				_selectedLanguagesElement.innerText = "All";
				ElementUtil.clearElement(_languagesElement);
				
				for (let i = 0; i < _langs.length; i++) {
					_languagesElement.append(ElementUtil.createElement("<div class=\"checkbox\"><input id=\"language" + _langs[i] + "\" name=\"" 
							+ _langs[i] + "\" type=\"checkbox\"><label for=\"language" + _langs[i] + "\"></label><span>" + _langs[i] + "</span><div>"));
					
					let checkbox = document.getElementById("language" + _langs[i]);
					checkbox.addEventListener("click", function() {
						if (this.checked)
							_selectedLangs[this.getAttribute("name")] = true;
						else delete _selectedLangs[this.getAttribute("name")];

						let text = "";
						for (let lang in _selectedLangs) {
							text += ", " + lang;
						}

						if (text.length > 0)
							_selectedLanguagesElement.innerText = text.substring(2);		
						else _selectedLanguagesElement.innerText = "All";
					});
				}
			} else {
				var req = new XMLHttpRequest();
				req.onreadystatechange = function() {
					if (req.readyState === 4 && (req.status === 200 || req.status == 0)) {
						let reg = /(\n)([A-Za-z])([A-Za-z0-9_ ]{0,})(:)([ ]{0,})(\n)/g;
						let args;
						while (args = reg.exec(req.responseText)) {
							if (args[3]) _langs.push(args[2] + args[3]);
						}
	
						if (_langs.length > 0)
							configureIssue();
					}
				};
				req.open("GET", _gitHubLanguagesURL, true);	
				req.send();
			}
		}
	}

	function randomIssue() {
		_infoElement.style.display = "none";
		_optionElement.style.display = "none";
		_issueElement.style.display = "none";
	}

	function loadIssue(repo, issue) {
		_infoElement.style.display = "none";
		_optionElement.style.display = "none";
		_issueElement.style.display = "none";
	}
</script>
